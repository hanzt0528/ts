Ps:长度不固定


Ts 长度固定188个字节.含有一到多道程序.传送流速率由参考时钟字段(PCR)的位置和数值所决定.

通道->通道特殊解码器->含有一道或多道程序的传送流->传送流多路解调和解码->(视音频解码器,时钟控制)->解码后的视频和音频.

传送流由两层构成:系统层和压缩层

PS程序流:
有变化和固定码率.
程序流的速率由系统参考时钟(SCR)和mux_rate字段的位置和数值决定.

通道->通道特殊解码器->程序流->程序流解码器->(视音频解码器,时钟控制)->解码后的视频和音频.

程序流也是由两层组成:系统层和压缩层.

I- 0.4 分组的原始数据流
具有相同流号的连续PES分组,可以用来构造PES流.
PES分组+原始流参考时钟(ESCR)+原始流速率(ES_Rate) =  PES流.

I- 0.7 多路复用宽操作
程序流和传送流都是由分组构成,分组首部规定了通道数据到达流解码器的预定时间.

解码器利用程序流的第一个分组传来的参数(流的最大数据率,视频通道的最高数目)协助其完成建立解码资源;传送流也同样包括这样的全局有效信息.
I-0.8单独的流操作(PES分组层)
多路分配
在编码的时候:
原始流多路复用 - > 程序流
原始流,程序流,其他传送流 - > 传送流.
原始流:视频数据流,音频数据流,私有流,保留流,填充流.
同步
多原始流的同步时通过程序流和传送流中的显示时间标签(PTS)完成,PTS一般90kHz为单位.
但系统参考时钟(SCR)和程序参考时钟(PCR)和可选的基本流参考时钟(ESCR)可以达到27MHz.


解码时间标签DTS: PES分组头部的一个字段,用来指明一个访问单元在系统目标解码器被解码的时间.
原始流参考时钟(ESCR):一个PES流中的时间标签,用来获得解码器的时序.

组:组首部+ 0-n分组
分组:分组首部+一个原始数据流的连续字节(分组数据)
分组标号PID:一个唯一的整数值.

PES:分组原始流的简写.
PES分组:pes分组首部+pes分组有效负载.
PES流:由PES分组构成,这些分组的有效负载全部来自单个的原始流的数据,具有相同的stream_id.
PTS:PES分组首部中的一个字段,用来指明一个显示单元在系统目标解码器中出现的时间.
显示单元PU:解码后的音频访问单元或解码后的图象.
程序:一组有相同的时间基点并可能同步显示的原始流的集合.
程序参考时钟PCR:传送流中的时间标签,用来获得解码器的时序.
系统参考时钟SCR:程序流中的时间标签,用来获得解码器的时序.

传送流 = 一道或多道程序组成.
一道程序 = 一个或多个原始流(PES)和一些其他流多路复用在一起组成.
原始流(PES) = 包含多个访问单元.(访问单元对于视频就是一幅图像).
原始数据流PES加载在PES分组中.PES分组插在传送流TS中.
PES分组首部以32位的开始码字起头.
pes分组首部可能含有解码和/或显示时间标签(DTS/PTS)

传送流分组,以4个字节的前缀开始.


PCR,放在TS包头的自适应区中,PCR共占6Bytes,其中6bits预留,42bits有效位,42bits分两部分:32bits的PCR-Base和9bits的PCR-Ext.


TS流的解析
解析工具 Elecard Stream Analyzer，其可以查看ts流的文件结构。

解析Ts，首先解析到PAT（pid = 0，固定） ，就可以知道有多少路节目，然后解析PMT，就可以知道每路节目，对应的视音频ts包的pid，根据相同pid，就可以解析视音频数据了。

一般PES包，是打包一帧视频或一帧时间内的音频数据。因此PES包，一般比较大，例如视频，就相当于一帧压缩数据的大小。为了便于在网络上进行传输，会将PES，分成许多ts包，进行传输。Ts包大小一般固定为188个字节。
Ts包结构分为：
Ts包头（4字节）+ 调整字段（可选，长度 不固定，有没有调整字段由ts包头内容决定） + ts有效负载。

是不是封装pes的第一个ts包，可以由ts包头内容（payload_unit_start_indicator =1）决定，如果是第一个ts包，则ts包有效负载内容为：
Ts包有效负载 = PES包头 + 视频或数据（送给解码器的数据），
Pes包头中有个字段PES_packet_length，如果不为0，则指明了pes报的大小；如果为0，则没有指明pes报的大小，对于没有指明解析到下一个ayload_unit_start_indicator =1时，上一个pes包结束。

其中视频数据的开始位置由pes包头中的PES_header_dada_length字段内容决定。

Pes第一个ts包
---------------------------
	第1个字节	  Ts头
	第2个字节	
	第3个字节	
	第4个字节	
---------------------------
	第5个字节	PES头
	第n个字节	
	PES_header_dada_length = 2（假设值）	
	PES_header_dada	
	PES_header_dada	
---------------------------
	。。。	    视频数据
	
---------------------------
	188字节	
---------------------------

Pes第n(n〉1)个ts包
---------------------------
	第1个字节	Ts头
	第2个字节	
	第3个字节	
	第4个字节	
---------------------------
	...         视频数据（184字节）
---------------------------
	188字节	
---------------------------







Pes最后一个ts包
---------------------------
	第1个字节	Ts头
	第2个字节	
	第3个字节	
	第4个字节	
---------------------------
调整字段（长度为m）
---------------------------
视频数据（长度 188 - 4 - m）

	188字节	
---------------------------


视频数据的开头包含了一些视频的信息，这些信息一般在第一个ts报中。

视频数据结构：
视频数据 = Sequence Header + Sequence Extension + Group of Picture Header +Picture Header + Picture Coding Extension + n各Slice（每个slice 包括n个MacroBlock,MacroBlock包含n个block）。
